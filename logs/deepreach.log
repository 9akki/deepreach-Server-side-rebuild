2025-11-08 14:05:04 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 14:05:04 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 14:05:06 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 57418 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 14:05:06 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 14:05:06 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 14:05:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 14:05:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 14:05:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 11 ms. Found 0 Redis repository interfaces.
2025-11-08 14:05:07 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 14:05:07 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 14:05:07 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 14:05:07 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 14:05:07 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 904 ms
2025-11-08 14:05:08 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 14:05:08 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 14:05:08 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 14:05:08 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 14:05:08 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 14:05:08 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@19bbb216, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@6cfac0bd, org.springframework.security.web.context.SecurityContextHolderFilter@a74c940, org.springframework.security.web.header.HeaderWriterFilter@7bbe852a, org.springframework.web.filter.CorsFilter@549debdb, org.springframework.security.web.authentication.logout.LogoutFilter@4be1c797, com.deepreach.common.security.JwtAuthenticationFilter@3d764641, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@51bc649e, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@7f09ff10, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@1edf52e6, org.springframework.security.web.session.SessionManagementFilter@3f2a7ca0, org.springframework.security.web.access.ExceptionTranslationFilter@b666366, org.springframework.security.web.access.intercept.AuthorizationFilter@39b9dc35]
2025-11-08 14:05:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 14:05:09 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.576 seconds (process running for 3.004)
2025-11-08 14:05:09 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 14:05:21 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 14:05:21 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 14:05:24 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 14:05:26 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 14:05:26 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 14:05:26 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 14:05:26 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 14:05:26 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 14:05:27 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 14:05:27 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 14:05:27 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 14:30:39 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-08 14:30:39 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-11-08 14:30:39 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2025-11-08 14:30:39 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing POST /auth/login
2025-11-08 14:30:39 [http-nio-8080-exec-2] DEBUG c.d.c.s.JwtAuthenticationFilter - 从请求中提取到Token: eyJhbGciOiJIUzI1NiJ9...
2025-11-08 14:30:39 [http-nio-8080-exec-2] DEBUG c.d.c.s.JwtAuthenticationFilter - 从Token中解析出用户名: buyer_sub_a1
2025-11-08 14:30:39 [http-nio-8080-exec-2] DEBUG c.d.c.s.JwtAuthenticationFilter - 开始加载用户详情: buyer_sub_a1
2025-11-08 14:30:39 [http-nio-8080-exec-2] DEBUG c.d.c.s.UserDetailsServiceImpl - 正在加载用户详情: buyer_sub_a1
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: buyer_sub_a1(String)
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 0
2025-11-08 14:30:59 [http-nio-8080-exec-2] WARN  c.d.c.s.UserDetailsServiceImpl - 用户不存在: buyer_sub_a1
2025-11-08 14:30:59 [http-nio-8080-exec-2] ERROR c.d.c.s.JwtAuthenticationFilter - JWT 认证过程中发生异常
org.springframework.security.core.userdetails.UsernameNotFoundException: 用户不存在: buyer_sub_a1
	at com.deepreach.common.security.UserDetailsServiceImpl.loadUserByUsername(UserDetailsServiceImpl.java:70)
	at com.deepreach.common.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:97)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-11-08 14:30:59 [http-nio-8080-exec-2] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/auth/login' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured POST /auth/login
2025-11-08 14:30:59 [http-nio-8080-exec-2] INFO  c.d.auth.controller.AuthController - 用户登录请求：admin
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 14:30:59 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: admin(String)
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 1
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 1(Long)
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserById - ==>  Preparing: SELECT DISTINCT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_name, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id WHERE u.user_id = ?
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserById - ==> Parameters: 1(Long)
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectUserById - <==      Total: 1
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.s.impl.SysUserServiceImpl - 查询用户成功：用户ID=1, 用户名=admin
2025-11-08 14:31:00 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.updateUserLoginInfo - ==>  Preparing: UPDATE sys_user SET login_ip = ?, login_time = ?, update_time = sysdate() WHERE user_id = ?
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.updateUserLoginInfo - ==> Parameters: 0:0:0:0:0:0:0:1(String), 2025-11-08T14:31:00.999016(LocalDateTime), 1(Long)
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.updateUserLoginInfo - <==    Updates: 1
2025-11-08 14:31:01 [http-nio-8080-exec-2] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户登录日志 - 用户ID: 1, 用户名: admin, 部门: , 登录IP: 0:0:0:0:0:0:0:1, 登录地点: , 登录时间: 2025-11-08T14:31:01.488288
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.s.impl.SysUserServiceImpl - 记录用户登录信息成功：用户ID=1, 用户名=admin, 登录IP=0:0:0:0:0:0:0:1
2025-11-08 14:31:01 [http-nio-8080-exec-2] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户登录成功：用户ID=1, 用户名=admin, 登录IP=0:0:0:0:0:0:0:1
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.s.impl.RedisSecurityCache - Stored user admin with token eyJhbGci... in Redis, expire in 21600 seconds
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectCompleteUserInfo - ==>  Preparing: SELECT u.user_id as id, u.username, u.nickname, u.real_name as realName, u.email, u.phone, u.avatar, u.user_type as userType, u.status, u.parent_user_id as parentUserId, u.invitation_code as invitationCode, u.login_ip as loginIp, u.login_time as loginTime, u.create_time as createTime, u.update_time as updateTime FROM sys_user u WHERE u.user_id = ? AND u.status = '0'
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectCompleteUserInfo - ==> Parameters: 1(Long)
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectCompleteUserInfo - <==      Total: 1
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 14:31:01 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 1(Long)
2025-11-08 14:31:02 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 14:31:02 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 14:31:02 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 14:31:02 [http-nio-8080-exec-2] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 14:31:02 [http-nio-8080-exec-2] INFO  c.d.auth.controller.AuthController - 用户 admin 登录成功，IP：0:0:0:0:0:0:0:1
2025-11-08 18:57:27 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 18:57:27 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 18:57:30 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 65575 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 18:57:30 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 18:57:30 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 18:57:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 18:57:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 18:57:31 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-11-08 18:57:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 18:57:31 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 18:57:31 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 18:57:31 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 18:57:31 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 872 ms
2025-11-08 18:57:32 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 18:57:32 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 18:57:32 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 18:57:32 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 18:57:32 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 18:57:32 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2bbaf983, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@781bd9dd, org.springframework.security.web.context.SecurityContextHolderFilter@18d14de3, org.springframework.security.web.header.HeaderWriterFilter@66576bd2, org.springframework.web.filter.CorsFilter@1cc42abe, org.springframework.security.web.authentication.logout.LogoutFilter@6075a4ea, com.deepreach.common.security.JwtAuthenticationFilter@4392362c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@15405ba1, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@f6e3b67, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@6f071d0c, org.springframework.security.web.session.SessionManagementFilter@13bf5fd, org.springframework.security.web.access.ExceptionTranslationFilter@5e8e02a3, org.springframework.security.web.access.intercept.AuthorizationFilter@5ead245]
2025-11-08 18:57:33 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 18:57:33 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.63 seconds (process running for 2.923)
2025-11-08 18:57:33 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 18:57:45 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 18:57:46 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 18:57:48 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 18:57:50 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 18:57:50 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 18:57:50 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 18:57:50 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 18:57:50 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 18:57:50 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 18:57:50 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 18:57:50 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 19:05:16 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 19:05:16 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 19:05:18 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 66045 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 19:05:18 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 19:05:18 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 19:05:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 19:05:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 19:05:18 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 9 ms. Found 0 Redis repository interfaces.
2025-11-08 19:05:19 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 19:05:19 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 19:05:19 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 19:05:19 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 19:05:19 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 902 ms
2025-11-08 19:05:19 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 19:05:19 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 19:05:19 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:05:20 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 19:05:20 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:05:20 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2eb03908, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@5ead245, org.springframework.security.web.context.SecurityContextHolderFilter@4a7ac98b, org.springframework.security.web.header.HeaderWriterFilter@14580edc, org.springframework.web.filter.CorsFilter@1e49a77e, org.springframework.security.web.authentication.logout.LogoutFilter@19bbb216, com.deepreach.common.security.JwtAuthenticationFilter@1e258d3b, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@13bf5fd, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@2eafb4e7, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@57466fb7, org.springframework.security.web.session.SessionManagementFilter@78f1d29, org.springframework.security.web.access.ExceptionTranslationFilter@109188b4, org.springframework.security.web.access.intercept.AuthorizationFilter@3f2169e9]
2025-11-08 19:05:20 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 19:05:20 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.802 seconds (process running for 3.331)
2025-11-08 19:05:20 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 19:05:34 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 19:05:34 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 19:05:36 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 19:05:38 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 19:05:38 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 19:05:38 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 19:05:38 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 19:05:38 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 19:05:38 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 19:05:38 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 19:05:38 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 19:22:24 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 19:22:24 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 19:22:27 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 66689 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 19:22:27 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 19:22:27 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 19:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 19:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 19:22:27 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 8 ms. Found 0 Redis repository interfaces.
2025-11-08 19:22:27 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 19:22:27 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 19:22:27 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 19:22:27 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 19:22:27 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 821 ms
2025-11-08 19:22:28 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 19:22:28 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 19:22:28 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:22:28 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 19:22:28 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:22:29 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@57466fb7, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7891742e, org.springframework.security.web.context.SecurityContextHolderFilter@2eafb4e7, org.springframework.security.web.header.HeaderWriterFilter@5e8e02a3, org.springframework.web.filter.CorsFilter@2bbaf983, org.springframework.security.web.authentication.logout.LogoutFilter@1edf52e6, com.deepreach.common.security.JwtAuthenticationFilter@24b3f778, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@18d14de3, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@469bd719, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@781bd9dd, org.springframework.security.web.session.SessionManagementFilter@4a7ac98b, org.springframework.security.web.access.ExceptionTranslationFilter@3f2a7ca0, org.springframework.security.web.access.intercept.AuthorizationFilter@1aea759d]
2025-11-08 19:22:29 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 19:22:29 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.679 seconds (process running for 3.055)
2025-11-08 19:22:29 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 19:22:43 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 19:22:43 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 19:22:46 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 19:22:47 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 19:22:47 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 19:22:47 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 19:22:47 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 19:22:47 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 19:22:48 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 19:22:48 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 19:22:48 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 19:31:42 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 19:31:42 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 19:31:43 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 67010 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 19:31:43 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 19:31:43 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 19:31:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 19:31:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 19:31:43 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-11-08 19:31:44 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 19:31:44 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 19:31:44 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 19:31:44 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 19:31:44 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 828 ms
2025-11-08 19:31:44 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 19:31:44 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 19:31:44 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:31:45 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 19:31:45 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:31:45 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@5ead245, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@1e49a77e, org.springframework.security.web.context.SecurityContextHolderFilter@35e3f3b8, org.springframework.security.web.header.HeaderWriterFilter@3f2a7ca0, org.springframework.web.filter.CorsFilter@57466fb7, org.springframework.security.web.authentication.logout.LogoutFilter@6cfac0bd, com.deepreach.common.security.JwtAuthenticationFilter@39f93225, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@2eafb4e7, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@32050628, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@7891742e, org.springframework.security.web.session.SessionManagementFilter@76c85485, org.springframework.security.web.access.ExceptionTranslationFilter@7091a016, org.springframework.security.web.access.intercept.AuthorizationFilter@6689bf04]
2025-11-08 19:31:45 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 19:31:45 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.538 seconds (process running for 2.83)
2025-11-08 19:31:45 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 19:31:56 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 19:31:56 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 19:31:58 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 19:32:00 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 19:32:00 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 19:32:00 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 19:32:00 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 19:32:00 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 19:32:00 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 19:32:00 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 19:32:00 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 19:32:06 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 19:32:06 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 19:32:07 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 67025 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 19:32:07 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 19:32:07 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 19:32:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 19:32:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 19:32:07 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-11-08 19:32:08 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 19:32:08 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 19:32:08 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 19:32:08 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 19:32:08 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 894 ms
2025-11-08 19:32:08 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 19:32:08 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 19:32:09 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:32:09 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 19:32:09 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 19:32:09 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@2eb03908, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@5ead245, org.springframework.security.web.context.SecurityContextHolderFilter@4a7ac98b, org.springframework.security.web.header.HeaderWriterFilter@14580edc, org.springframework.web.filter.CorsFilter@1e49a77e, org.springframework.security.web.authentication.logout.LogoutFilter@19bbb216, com.deepreach.common.security.JwtAuthenticationFilter@1e258d3b, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@13bf5fd, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@2eafb4e7, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@57466fb7, org.springframework.security.web.session.SessionManagementFilter@78f1d29, org.springframework.security.web.access.ExceptionTranslationFilter@109188b4, org.springframework.security.web.access.intercept.AuthorizationFilter@3f2169e9]
2025-11-08 19:32:09 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 19:32:09 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.858 seconds (process running for 3.122)
2025-11-08 19:32:09 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 19:32:13 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 20:05:01 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 67568 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 20:05:01 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 20:05:01 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 20:05:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 20:05:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 20:05:01 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-11-08 20:05:02 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 20:05:02 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 20:05:02 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 20:05:02 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 20:05:02 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 878 ms
2025-11-08 20:05:02 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 20:05:02 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 20:05:02 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 20:05:03 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 20:05:03 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 20:05:03 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@1e49a77e, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@57466fb7, org.springframework.security.web.context.SecurityContextHolderFilter@13bf5fd, org.springframework.security.web.header.HeaderWriterFilter@23e297d9, org.springframework.web.filter.CorsFilter@7891742e, org.springframework.security.web.authentication.logout.LogoutFilter@549debdb, com.deepreach.common.security.JwtAuthenticationFilter@24b3f778, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@32050628, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@18d14de3, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@2bbaf983, org.springframework.security.web.session.SessionManagementFilter@65294247, org.springframework.security.web.access.ExceptionTranslationFilter@14580edc, org.springframework.security.web.access.intercept.AuthorizationFilter@2b9615cb]
2025-11-08 20:05:03 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 20:05:03 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.536 seconds (process running for 2.827)
2025-11-08 20:05:03 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 20:05:15 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 20:05:15 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 20:05:18 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 20:05:20 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 20:05:20 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 20:05:20 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 20:05:20 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 20:05:20 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 20:05:20 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 20:05:20 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 20:05:20 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 20:05:33 [http-nio-8080-exec-3] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-08 20:05:33 [http-nio-8080-exec-3] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-11-08 20:05:33 [http-nio-8080-exec-3] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 4 ms
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Securing GET /dr/balance/pricing-mode
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.s.JwtAuthenticationFilter - 从请求中提取到Token: eyJhbGciOiJIUzI1NiJ9...
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.s.JwtAuthenticationFilter - 从Token中解析出用户名: admin
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.s.JwtAuthenticationFilter - 开始加载用户详情: admin
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.s.UserDetailsServiceImpl - 正在加载用户详情: admin
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: admin(String)
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 1
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==>  Preparing: SELECT DISTINCT r.role_id, r.role_name, r.role_key, r.role_sort, r.data_scope, r.status, r.del_flag, r.create_time, r.update_time FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==> Parameters: 1(Long)
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectRolesByUserId - <==      Total: 1
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 20:05:33 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.s.UserDetailsServiceImpl - 普通用户 admin 获取权限: 19
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.s.UserDetailsServiceImpl - 用户详情加载成功: admin, 角色: 1, 权限数量: 19
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.s.JwtAuthenticationFilter - 用户详情加载成功: admin
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.s.JwtAuthenticationFilter - Token验证结果: true
2025-11-08 20:05:34 [http-nio-8080-exec-3] INFO  c.d.c.s.JwtAuthenticationFilter - 用户 admin 认证成功
2025-11-08 20:05:34 [http-nio-8080-exec-3] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/dr/balance/pricing-mode' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG o.s.security.web.FilterChainProxy - Secured GET /dr/balance/pricing-mode
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.c.i.PerformanceInterceptor - 开始处理请求: GET /api/dr/balance/pricing-mode from 127.0.0.1
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: TOKEN(String)
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: BY_TIMES(String)
2025-11-08 20:05:34 [http-nio-8080-exec-3] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:05:34 [http-nio-8080-exec-3] INFO  c.d.c.i.PerformanceInterceptor - 请求处理完成: GET /api/dr/balance/pricing-mode from 127.0.0.1 - 状态: 200 - 耗时: 439ms
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Securing GET /dr/balance/pricing-mode
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.s.JwtAuthenticationFilter - 从请求中提取到Token: eyJhbGciOiJIUzI1NiJ9...
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.s.JwtAuthenticationFilter - 从Token中解析出用户名: admin
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.s.JwtAuthenticationFilter - 开始加载用户详情: admin
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.s.UserDetailsServiceImpl - 正在加载用户详情: admin
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:06:13 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: admin(String)
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 1
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==>  Preparing: SELECT DISTINCT r.role_id, r.role_name, r.role_key, r.role_sort, r.data_scope, r.status, r.del_flag, r.create_time, r.update_time FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==> Parameters: 1(Long)
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectRolesByUserId - <==      Total: 1
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.s.UserDetailsServiceImpl - 普通用户 admin 获取权限: 19
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.s.UserDetailsServiceImpl - 用户详情加载成功: admin, 角色: 1, 权限数量: 19
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.s.JwtAuthenticationFilter - 用户详情加载成功: admin
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.s.JwtAuthenticationFilter - Token验证结果: true
2025-11-08 20:06:14 [http-nio-8080-exec-4] INFO  c.d.c.s.JwtAuthenticationFilter - 用户 admin 认证成功
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG o.s.security.web.FilterChainProxy - Secured GET /dr/balance/pricing-mode
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.c.i.PerformanceInterceptor - 开始处理请求: GET /api/dr/balance/pricing-mode from 127.0.0.1
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: TOKEN(String)
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: BY_TIMES(String)
2025-11-08 20:06:14 [http-nio-8080-exec-4] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:06:14 [http-nio-8080-exec-4] INFO  c.d.c.i.PerformanceInterceptor - 请求处理完成: GET /api/dr/balance/pricing-mode from 127.0.0.1 - 状态: 200 - 耗时: 403ms
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Securing POST /dr/balance/deduct
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.s.JwtAuthenticationFilter - 从请求中提取到Token: eyJhbGciOiJIUzI1NiJ9...
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.s.JwtAuthenticationFilter - 从Token中解析出用户名: admin
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.s.JwtAuthenticationFilter - 开始加载用户详情: admin
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.s.UserDetailsServiceImpl - 正在加载用户详情: admin
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: admin(String)
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 1
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==>  Preparing: SELECT DISTINCT r.role_id, r.role_name, r.role_key, r.role_sort, r.data_scope, r.status, r.del_flag, r.create_time, r.update_time FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==> Parameters: 1(Long)
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRolesByUserId - <==      Total: 1
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 20:08:51 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.s.UserDetailsServiceImpl - 普通用户 admin 获取权限: 19
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.s.UserDetailsServiceImpl - 用户详情加载成功: admin, 角色: 1, 权限数量: 19
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.s.JwtAuthenticationFilter - 用户详情加载成功: admin
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.s.JwtAuthenticationFilter - Token验证结果: true
2025-11-08 20:08:52 [http-nio-8080-exec-7] INFO  c.d.c.s.JwtAuthenticationFilter - 用户 admin 认证成功
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG o.s.security.web.FilterChainProxy - Secured POST /dr/balance/deduct
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.i.PerformanceInterceptor - 开始处理请求: POST /api/dr/balance/deduct from 127.0.0.1
2025-11-08 20:08:52 [http-nio-8080-exec-7] INFO  c.deepreach.common.aspect.LogAspect - LogAspect doBefore 被触发: DR积分扣费 - deduct
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.deepreach.common.aspect.LogAspect - 操作日志前置处理完成: DR积分扣费
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: TOKEN(String)
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: BY_TIMES(String)
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.user_id = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - ==> Parameters: 400(Long)
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - <==      Total: 1
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:08:52 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 400(Long)
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.user_id = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - ==> Parameters: 395(Long)
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserWithDept - <==      Total: 1
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 395(Long)
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:08:53 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserById - ==>  Preparing: SELECT DISTINCT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_name, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id WHERE u.user_id = ?
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserById - ==> Parameters: 400(Long)
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.c.c.m.S.selectUserById - <==      Total: 1
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.c.c.s.impl.SysUserServiceImpl - 查询用户成功：用户ID=400, 用户名=ceshi0006
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.updateBalanceWithVersion - ==>  Preparing: update user_dr_balance set dr_balance = ?, pre_deducted_balance = ?, total_recharge = ?, total_consume = ?, total_refund = ?, frozen_amount = ?, version = version + 1, update_time = now() where user_id = ? and version = ?
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.updateBalanceWithVersion - ==> Parameters: 999.129800(BigDecimal), 0.0000(BigDecimal), 1000.0000(BigDecimal), 0.870200(BigDecimal), 0.0000(BigDecimal), 0.0000(BigDecimal), 395(Long), 14(Integer)
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.updateBalanceWithVersion - <==    Updates: 1
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.DrBillingRecordMapper.insert - ==>  Preparing: insert into dr_billing_record ( bill_no, user_id, operator_id, bill_type, billing_type, business_type, business_id, dr_amount, balance_before, balance_after, description, remark, extra_data, consumer, status, create_by, create_time ) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-11-08 20:08:54 [http-nio-8080-exec-7] DEBUG c.d.w.m.DrBillingRecordMapper.insert - ==> Parameters: DR20251108200854123405(String), 395(Long), 400(Long), 2(Integer), 1(Integer), BY_TIMES(String), null, 0.010000(BigDecimal), 999.1398(BigDecimal), 999.129800(BigDecimal), 翻译扣费(String), null, null, ceshi0006(String), null, null, 2025-11-08T20:08:54.894703(LocalDateTime)
2025-11-08 20:08:55 [http-nio-8080-exec-7] DEBUG c.d.w.m.DrBillingRecordMapper.insert - <==    Updates: 1
2025-11-08 20:08:55 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:08:55 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:08:55 [http-nio-8080-exec-7] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:08:56 [http-nio-8080-exec-7] INFO  c.deepreach.common.aspect.LogAspect - 保存操作日志: DR积分扣费 - admin - /api/dr/balance/deduct - 成功
2025-11-08 20:08:56 [http-nio-8080-exec-7] INFO  c.deepreach.common.aspect.LogAspect - 操作日志对象详情: operId=null, title=DR积分扣费, operName=admin, operUrl=/api/dr/balance/deduct, status=0
2025-11-08 20:08:56 [http-nio-8080-exec-7] INFO  c.deepreach.common.aspect.LogAspect - 准备异步保存操作日志到数据库...
2025-11-08 20:08:56 [http-nio-8080-exec-7] INFO  c.deepreach.common.aspect.LogAspect - 操作日志异步保存任务已提交
2025-11-08 20:08:56 [http-nio-8080-exec-7] DEBUG c.deepreach.common.aspect.LogAspect - 操作日志返回处理完成: DR积分扣费
2025-11-08 20:08:56 [pool-3-thread-1] DEBUG c.d.c.c.m.S.insertOperLog - ==>  Preparing: INSERT INTO sys_oper_log ( title, business_type, method, request_method, operator_type, oper_name, dept_name, oper_url, oper_ip, oper_location, oper_param, json_result, status, error_msg, oper_time, cost_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-11-08 20:08:56 [http-nio-8080-exec-7] INFO  c.d.c.i.PerformanceInterceptor - 请求处理完成: POST /api/dr/balance/deduct from 127.0.0.1 - 状态: 200 - 耗时: 3914ms
2025-11-08 20:08:56 [pool-3-thread-1] DEBUG c.d.c.c.m.S.insertOperLog - ==> Parameters: DR积分扣费(String), 2(Integer), com.deepreach.web.controller.DrBalanceController.deduct(String), POST(String), 1(Integer), admin(String), ADMIN(String), /api/dr/balance/deduct(String), 127.0.0.1(String), null, [{"searchValue":null,"createBy":null,"createTime":null,"updateBy":null,"updateTime":null,"remark":null,"params":{},"billId":null,"billNo":null,"userId":400,"operatorId":null,"billType":null,"billingType":null,"businessType":"TOKEN","businessId":null,"username":null,"level1Commission":null,"level2Commission":null,"level3Commission":null,"drAmount":12.3456,"balanceBefore":null,"balanceAfter":null,"description":"翻译扣费","extraData":null,"consumer":null,"status":null,"billTypeDisplay":"未知","billingTypeDisplay":"未知","businessTypeDisplay":"AI服务","recharge":false,"consume":false,"refund":false,"paramSize":0}](String), {"code":200,"message":"扣费成功","data":{"success":true,"message":"扣费成功","userBalance":{"searchValue":null,"createBy":"system","createTime":"2025-11-07 00:19:09","updateBy":"","updateTime":"2025-11-08 20:08:54","remark":null,"params":{},"balanceId":55,"userId":395,"drBalance":999.1298,"preDeductedBalance":0.0000,"totalRecharge":1000.0000,"totalConsume":0.8702,"totalRefund":0.0000,"frozenAmount":0.0000,"version":15,"status":"0","aiCharacterFreeTimes":1,"frozen":false,"cancelled":false,"availableBalance":999.1298,"totalAvailableBalance":999.1298,"normal":true,"paramSize":0},"billingRecord":{"searchValue":null,"createBy":null,"createTime":"2025-11-08 20:08:54","updateBy":null,"updateTime":null,"remark":null,"params":{},"billId":2215,"billNo":"DR20251108200854123405","userId":395,"operatorId":400,"billType":2,"billingType":1,"businessType":"BY_TIMES","businessId":null,"username":null,"level1Commission":null,"level2Commission":null,"level3Commission":null,"drAmount":0.010000,"balanceBefore":999.1398,"balanceAfter":999.129800,"description":"翻译扣费","extraData":null,"consumer":"ceshi0006","status":null,"billTypeDisplay":"消费","billingTypeDisplay":"秒结秒扣","businessTypeDisplay":"按次扣费","recharge":false,"consume":true,"refund":false,"paramSize":0},"deductAmount":0.010000,"balanceBefore":999.1398,"balanceAfter":999.1298,"availableBalance":999.1298,"preDeductedBalance":0.0000,"totalRecharge":1000.0000,"totalConsume":0.8702,"totalRefund":0.0000,"frozenAmount":0.0000,"actualUserId":395,"requestUserId":400,"operatorId":400,"businessType":"BY_TIMES","billNo":"DR20251108200854123405"},"success":true,"timestamp":1762603736086}(String), 0(Integer), null, 2025-11-08T20:08:52.237624(LocalDateTime), 3853(Long)
2025-11-08 20:08:56 [http-nio-8080-exec-7] WARN  c.d.c.i.PerformanceInterceptor - 检测到慢请求: POST /api/dr/balance/deduct from 127.0.0.1 - 耗时: 3914ms - 超过阈值: 3000ms
2025-11-08 20:08:56 [pool-3-thread-1] DEBUG c.d.c.c.m.S.insertOperLog - <==    Updates: 1
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Securing POST /dr/balance/deduct
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.s.JwtAuthenticationFilter - 从请求中提取到Token: eyJhbGciOiJIUzI1NiJ9...
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.s.JwtAuthenticationFilter - 从Token中解析出用户名: admin
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.s.JwtAuthenticationFilter - 开始加载用户详情: admin
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.s.UserDetailsServiceImpl - 正在加载用户详情: admin
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.username = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:10:18 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - ==> Parameters: admin(String)
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithRolesAndPermissions - <==      Total: 1
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==>  Preparing: SELECT DISTINCT r.role_id, r.role_name, r.role_key, r.role_sort, r.data_scope, r.status, r.del_flag, r.create_time, r.update_time FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRolesByUserId - ==> Parameters: 1(Long)
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRolesByUserId - <==      Total: 1
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==>  Preparing: SELECT DISTINCT m.perms FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON rm.menu_id = m.menu_id WHERE u.user_id = ? AND u.status = '0' AND m.status = 0 AND m.perms IS NOT NULL AND m.perms != ''
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - ==> Parameters: 1(Long)
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectPermissionsByUserId - <==      Total: 19
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.s.UserDetailsServiceImpl - 普通用户 admin 获取权限: 19
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.s.UserDetailsServiceImpl - 用户详情加载成功: admin, 角色: 1, 权限数量: 19
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.s.JwtAuthenticationFilter - 用户详情加载成功: admin
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.s.JwtAuthenticationFilter - Token验证结果: true
2025-11-08 20:10:19 [http-nio-8080-exec-10] INFO  c.d.c.s.JwtAuthenticationFilter - 用户 admin 认证成功
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG o.s.security.web.FilterChainProxy - Secured POST /dr/balance/deduct
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.i.PerformanceInterceptor - 开始处理请求: POST /api/dr/balance/deduct from 127.0.0.1
2025-11-08 20:10:19 [http-nio-8080-exec-10] INFO  c.deepreach.common.aspect.LogAspect - LogAspect doBefore 被触发: DR积分扣费 - deduct
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.deepreach.common.aspect.LogAspect - 操作日志前置处理完成: DR积分扣费
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: TOKEN(String)
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: BY_TIMES(String)
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.user_id = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:10:19 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - ==> Parameters: 400(Long)
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - <==      Total: 1
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 400(Long)
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - ==>  Preparing: SELECT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_id, d.parent_id, d.ancestors, d.dept_name, d.order_num as dept_order_num, d.leader as dept_leader, d.phone as dept_phone, d.email as dept_email, d.status as dept_status, d.del_flag as dept_del_flag, d.level, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys, r.role_key FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id AND r.del_flag = '0' WHERE u.user_id = ? AND u.status = '0' ORDER BY r.role_sort
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - ==> Parameters: 395(Long)
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserWithDept - <==      Total: 1
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==>  Preparing: SELECT DISTINCT r.role_key FROM sys_user u LEFT JOIN sys_user_role ur ON u.user_id = ur.user_id LEFT JOIN sys_role r ON ur.role_id = r.role_id WHERE u.user_id = ? AND u.status = '0' AND r.status = '0' AND r.del_flag = '0'
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - ==> Parameters: 395(Long)
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectRoleKeysByUserId - <==      Total: 1
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:10:20 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserById - ==>  Preparing: SELECT DISTINCT u.user_id, u.username, u.password, u.nickname, u.real_name, u.email, u.phone, u.gender, u.avatar, u.user_type, u.status, u.dept_id, u.parent_user_id, u.invitation_code, u.login_ip, u.login_time, u.create_by, u.create_time, u.update_by, u.update_time, u.remark, d.dept_name, d.leader_user_id AS leader_id, leader.nickname AS leader_nickname, parent.username AS parent_username, parent_roles.parent_role_keys FROM sys_user u LEFT JOIN sys_dept d ON u.dept_id = d.dept_id AND d.del_flag = '0' LEFT JOIN sys_user leader ON d.leader_user_id = leader.user_id LEFT JOIN sys_user parent ON u.parent_user_id = parent.user_id LEFT JOIN ( SELECT pur.user_id, GROUP_CONCAT(DISTINCT sr.role_key ORDER BY sr.role_key) AS parent_role_keys FROM sys_user_role pur JOIN sys_role sr ON pur.role_id = sr.role_id AND sr.del_flag = '0' GROUP BY pur.user_id ) parent_roles ON parent.user_id = parent_roles.user_id WHERE u.user_id = ?
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserById - ==> Parameters: 400(Long)
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.c.c.m.S.selectUserById - <==      Total: 1
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.c.c.s.impl.SysUserServiceImpl - 查询用户成功：用户ID=400, 用户名=ceshi0006
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.updateBalanceWithVersion - ==>  Preparing: update user_dr_balance set dr_balance = ?, pre_deducted_balance = ?, total_recharge = ?, total_consume = ?, total_refund = ?, frozen_amount = ?, version = version + 1, update_time = now() where user_id = ? and version = ?
2025-11-08 20:10:21 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.updateBalanceWithVersion - ==> Parameters: 986.7842(BigDecimal), 0.0000(BigDecimal), 1000.0000(BigDecimal), 13.2158(BigDecimal), 0.0000(BigDecimal), 0.0000(BigDecimal), 395(Long), 15(Integer)
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.updateBalanceWithVersion - <==    Updates: 1
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.DrBillingRecordMapper.insert - ==>  Preparing: insert into dr_billing_record ( bill_no, user_id, operator_id, bill_type, billing_type, business_type, business_id, dr_amount, balance_before, balance_after, description, remark, extra_data, consumer, status, create_by, create_time ) values ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.DrBillingRecordMapper.insert - ==> Parameters: DR20251108201021122054(String), 395(Long), 400(Long), 2(Integer), 1(Integer), TOKEN(String), null, 12.3456(BigDecimal), 999.1298(BigDecimal), 986.7842(BigDecimal), 翻译扣费(String), null, null, ceshi0006(String), null, null, 2025-11-08T20:10:22.278426(LocalDateTime)
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.DrBillingRecordMapper.insert - <==    Updates: 1
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==>  Preparing: select balance_id, user_id, dr_balance, pre_deducted_balance, total_recharge, total_consume, total_refund, frozen_amount, version, status, ai_character_free_times, create_by, create_time, update_by, update_time, remark from user_dr_balance where user_id = ?
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - ==> Parameters: 395(Long)
2025-11-08 20:10:22 [http-nio-8080-exec-10] DEBUG c.d.w.m.U.selectByUserId - <==      Total: 1
2025-11-08 20:10:23 [http-nio-8080-exec-10] INFO  c.deepreach.common.aspect.LogAspect - 保存操作日志: DR积分扣费 - admin - /api/dr/balance/deduct - 成功
2025-11-08 20:10:23 [http-nio-8080-exec-10] INFO  c.deepreach.common.aspect.LogAspect - 操作日志对象详情: operId=null, title=DR积分扣费, operName=admin, operUrl=/api/dr/balance/deduct, status=0
2025-11-08 20:10:23 [http-nio-8080-exec-10] INFO  c.deepreach.common.aspect.LogAspect - 准备异步保存操作日志到数据库...
2025-11-08 20:10:23 [http-nio-8080-exec-10] INFO  c.deepreach.common.aspect.LogAspect - 操作日志异步保存任务已提交
2025-11-08 20:10:23 [http-nio-8080-exec-10] DEBUG c.deepreach.common.aspect.LogAspect - 操作日志返回处理完成: DR积分扣费
2025-11-08 20:10:23 [pool-3-thread-2] DEBUG c.d.c.c.m.S.insertOperLog - ==>  Preparing: INSERT INTO sys_oper_log ( title, business_type, method, request_method, operator_type, oper_name, dept_name, oper_url, oper_ip, oper_location, oper_param, json_result, status, error_msg, oper_time, cost_time ) VALUES ( ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ? )
2025-11-08 20:10:23 [pool-3-thread-2] DEBUG c.d.c.c.m.S.insertOperLog - ==> Parameters: DR积分扣费(String), 2(Integer), com.deepreach.web.controller.DrBalanceController.deduct(String), POST(String), 1(Integer), admin(String), ADMIN(String), /api/dr/balance/deduct(String), 127.0.0.1(String), null, [{"searchValue":null,"createBy":null,"createTime":null,"updateBy":null,"updateTime":null,"remark":null,"params":{},"billId":null,"billNo":null,"userId":400,"operatorId":null,"billType":null,"billingType":null,"businessType":"TOKEN","businessId":null,"username":null,"level1Commission":null,"level2Commission":null,"level3Commission":null,"drAmount":12.3456,"balanceBefore":null,"balanceAfter":null,"description":"翻译扣费","extraData":null,"consumer":null,"status":null,"billTypeDisplay":"未知","billingTypeDisplay":"未知","businessTypeDisplay":"AI服务","recharge":false,"consume":false,"refund":false,"paramSize":0}](String), {"code":200,"message":"扣费成功","data":{"success":true,"message":"扣费成功","userBalance":{"searchValue":null,"createBy":"system","createTime":"2025-11-07 00:19:09","updateBy":"","updateTime":"2025-11-08 20:10:22","remark":null,"params":{},"balanceId":55,"userId":395,"drBalance":986.7842,"preDeductedBalance":0.0000,"totalRecharge":1000.0000,"totalConsume":13.2158,"totalRefund":0.0000,"frozenAmount":0.0000,"version":16,"status":"0","aiCharacterFreeTimes":1,"frozen":false,"cancelled":false,"availableBalance":986.7842,"totalAvailableBalance":986.7842,"normal":true,"paramSize":0},"billingRecord":{"searchValue":null,"createBy":null,"createTime":"2025-11-08 20:10:22","updateBy":null,"updateTime":null,"remark":null,"params":{},"billId":2216,"billNo":"DR20251108201021122054","userId":395,"operatorId":400,"billType":2,"billingType":1,"businessType":"TOKEN","businessId":null,"username":null,"level1Commission":null,"level2Commission":null,"level3Commission":null,"drAmount":12.3456,"balanceBefore":999.1298,"balanceAfter":986.7842,"description":"翻译扣费","extraData":null,"consumer":"ceshi0006","status":null,"billTypeDisplay":"消费","billingTypeDisplay":"秒结秒扣","businessTypeDisplay":"AI服务","recharge":false,"consume":true,"refund":false,"paramSize":0},"deductAmount":12.3456,"balanceBefore":999.1298,"balanceAfter":986.7842,"availableBalance":986.7842,"preDeductedBalance":0.0000,"totalRecharge":1000.0000,"totalConsume":13.2158,"totalRefund":0.0000,"frozenAmount":0.0000,"actualUserId":395,"requestUserId":400,"operatorId":400,"businessType":"TOKEN","billNo":"DR20251108201021122054"},"success":true,"timestamp":1762603823272}(String), 0(Integer), null, 2025-11-08T20:10:19.501944(LocalDateTime), 3771(Long)
2025-11-08 20:10:23 [http-nio-8080-exec-10] INFO  c.d.c.i.PerformanceInterceptor - 请求处理完成: POST /api/dr/balance/deduct from 127.0.0.1 - 状态: 200 - 耗时: 3782ms
2025-11-08 20:10:23 [http-nio-8080-exec-10] WARN  c.d.c.i.PerformanceInterceptor - 检测到慢请求: POST /api/dr/balance/deduct from 127.0.0.1 - 耗时: 3782ms - 超过阈值: 3000ms
2025-11-08 20:10:23 [pool-3-thread-2] DEBUG c.d.c.c.m.S.insertOperLog - <==    Updates: 1
2025-11-08 20:21:20 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /dr/balance/pricing-mode
2025-11-08 20:21:20 [http-nio-8080-exec-2] WARN  c.d.c.s.JwtAuthenticationFilter - 从请求中未能提取到有效Token
2025-11-08 20:21:20 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-11-08 20:21:20 [http-nio-8080-exec-2] WARN  c.d.c.s.JwtAuthenticationEntryPoint - 未授权访问: GET /api/dr/balance/pricing-mode
org.springframework.security.authentication.InsufficientAuthenticationException: Full authentication is required to access this resource
	at org.springframework.security.web.access.ExceptionTranslationFilter.handleAccessDeniedException(ExceptionTranslationFilter.java:199)
	at org.springframework.security.web.access.ExceptionTranslationFilter.handleSpringSecurityException(ExceptionTranslationFilter.java:178)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:147)
	at org.springframework.security.web.access.ExceptionTranslationFilter.doFilter(ExceptionTranslationFilter.java:120)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:131)
	at org.springframework.security.web.session.SessionManagementFilter.doFilter(SessionManagementFilter.java:85)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.AnonymousAuthenticationFilter.doFilter(AnonymousAuthenticationFilter.java:100)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter.doFilter(SecurityContextHolderAwareRequestFilter.java:179)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.savedrequest.RequestCacheAwareFilter.doFilter(RequestCacheAwareFilter.java:63)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at com.deepreach.common.security.JwtAuthenticationFilter.doFilterInternal(JwtAuthenticationFilter.java:136)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:107)
	at org.springframework.security.web.authentication.logout.LogoutFilter.doFilter(LogoutFilter.java:93)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.web.filter.CorsFilter.doFilterInternal(CorsFilter.java:91)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.header.HeaderWriterFilter.doHeadersAfter(HeaderWriterFilter.java:90)
	at org.springframework.security.web.header.HeaderWriterFilter.doFilterInternal(HeaderWriterFilter.java:75)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:82)
	at org.springframework.security.web.context.SecurityContextHolderFilter.doFilter(SecurityContextHolderFilter.java:69)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter.doFilterInternal(WebAsyncManagerIntegrationFilter.java:62)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.session.DisableEncodeUrlFilter.doFilterInternal(DisableEncodeUrlFilter.java:42)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.springframework.security.web.FilterChainProxy$VirtualFilterChain.doFilter(FilterChainProxy.java:374)
	at org.springframework.security.web.FilterChainProxy.doFilterInternal(FilterChainProxy.java:233)
	at org.springframework.security.web.FilterChainProxy.doFilter(FilterChainProxy.java:191)
	at org.springframework.web.filter.DelegatingFilterProxy.invokeDelegate(DelegatingFilterProxy.java:352)
	at org.springframework.web.filter.DelegatingFilterProxy.doFilter(DelegatingFilterProxy.java:268)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116)
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:174)
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:149)
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167)
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90)
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:482)
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:115)
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93)
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:340)
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:391)
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63)
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:896)
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1744)
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1191)
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:659)
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)
	at java.base/java.lang.Thread.run(Thread.java:840)
2025-11-08 20:21:23 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 20:21:23 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 20:21:25 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 67849 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 20:21:25 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 20:21:25 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 20:21:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 20:21:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 20:21:26 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-11-08 20:21:26 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 20:21:26 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 20:21:26 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 20:21:26 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 20:21:26 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 899 ms
2025-11-08 20:21:26 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 20:21:27 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 20:21:27 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 20:21:27 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 20:21:27 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 20:21:27 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@57466fb7, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@7891742e, org.springframework.security.web.context.SecurityContextHolderFilter@2eafb4e7, org.springframework.security.web.header.HeaderWriterFilter@5e8e02a3, org.springframework.web.filter.CorsFilter@2bbaf983, org.springframework.security.web.authentication.logout.LogoutFilter@1edf52e6, com.deepreach.common.security.JwtAuthenticationFilter@24b3f778, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@18d14de3, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@469bd719, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@781bd9dd, org.springframework.security.web.session.SessionManagementFilter@4a7ac98b, org.springframework.security.web.access.ExceptionTranslationFilter@3f2a7ca0, org.springframework.security.web.access.intercept.AuthorizationFilter@1aea759d]
2025-11-08 20:21:28 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 20:21:28 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.563 seconds (process running for 2.858)
2025-11-08 20:21:28 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 20:21:41 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 20:21:41 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 20:21:43 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 20:21:45 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 20:21:45 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 20:21:45 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 20:21:45 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 20:21:45 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 20:21:45 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 20:21:45 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 20:21:45 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 20:21:49 [http-nio-8080-exec-2] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-11-08 20:21:49 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Initializing Servlet 'dispatcherServlet'
2025-11-08 20:21:49 [http-nio-8080-exec-2] INFO  o.s.web.servlet.DispatcherServlet - Completed initialization in 1 ms
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Securing GET /dr/balance/pricing-mode
2025-11-08 20:21:49 [http-nio-8080-exec-2] WARN  c.d.c.s.JwtAuthenticationFilter - 从请求中未能提取到有效Token
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG o.s.s.w.a.AnonymousAuthenticationFilter - Set SecurityContextHolder to anonymous SecurityContext
2025-11-08 20:21:49 [http-nio-8080-exec-2] WARN  o.s.w.s.h.HandlerMappingIntrospector - Cache miss for REQUEST dispatch to '/api/dr/balance/pricing-mode' (previous null). Performing MatchableHandlerMapping lookup. This is logged once only at WARN level, and every time at TRACE.
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG o.s.security.web.FilterChainProxy - Secured GET /dr/balance/pricing-mode
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.c.i.PerformanceInterceptor - 开始处理请求: GET /api/dr/balance/pricing-mode from 127.0.0.1
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: TOKEN(String)
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==>  Preparing: select price_id, business_type, business_name, price_unit, dr_price, billing_type, status, create_time, update_time, create_by, update_by, remark from dr_price_config where business_type = ?
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - ==> Parameters: BY_TIMES(String)
2025-11-08 20:21:49 [http-nio-8080-exec-2] DEBUG c.d.w.m.D.selectDrPriceConfigByBusinessType - <==      Total: 1
2025-11-08 20:21:49 [http-nio-8080-exec-2] INFO  c.d.c.i.PerformanceInterceptor - 请求处理完成: GET /api/dr/balance/pricing-mode from 127.0.0.1 - 状态: 200 - 耗时: 565ms
2025-11-08 23:00:16 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 23:00:16 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 23:00:19 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 76600 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 23:00:19 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 23:00:19 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 23:00:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 23:00:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 23:00:19 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-11-08 23:00:20 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 23:00:20 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 23:00:20 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 23:00:20 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 23:00:20 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 861 ms
2025-11-08 23:00:20 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 23:00:20 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 23:00:20 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:00:21 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 23:00:21 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:00:21 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@330d16af, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@16f15a4, org.springframework.security.web.context.SecurityContextHolderFilter@7b38db21, org.springframework.security.web.header.HeaderWriterFilter@2eafb4e7, org.springframework.web.filter.CorsFilter@548c5127, org.springframework.security.web.authentication.logout.LogoutFilter@1cc42abe, com.deepreach.common.security.JwtAuthenticationFilter@58021c3c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6a26eee6, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@4be1c797, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@35630ee8, org.springframework.security.web.session.SessionManagementFilter@26c1244c, org.springframework.security.web.access.ExceptionTranslationFilter@35e3f3b8, org.springframework.security.web.access.intercept.AuthorizationFilter@669469c9]
2025-11-08 23:00:21 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 23:00:21 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.544 seconds (process running for 2.808)
2025-11-08 23:00:21 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 23:00:22 [main] ERROR c.alibaba.druid.pool.DruidDataSource - init datasource error, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:939)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1463)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1459)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:83)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:388)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:476)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:486)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:519)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:526)
	at com.deepreach.web.config.DataSourceHealthCheck.run(DataSourceHealthCheck.java:35)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:786)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:770)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:765)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:330)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.deepreach.web.DeepReachApplication.main(DeepReachApplication.java:37)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 33 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 39 common frames omitted
2025-11-08 23:00:22 [main] ERROR c.alibaba.druid.pool.DruidDataSource - {dataSource-1} init error
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:939)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1463)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1459)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:83)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:388)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:476)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:486)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:519)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:526)
	at com.deepreach.web.config.DataSourceHealthCheck.run(DataSourceHealthCheck.java:35)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:786)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:770)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:765)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:330)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.deepreach.web.DeepReachApplication.main(DeepReachApplication.java:37)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 33 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 39 common frames omitted
2025-11-08 23:00:22 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 23:00:22 [main] ERROR c.d.web.config.DataSourceHealthCheck - 主数据源连接失败
org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:388)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:476)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:486)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:519)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:526)
	at com.deepreach.web.config.DataSourceHealthCheck.run(DataSourceHealthCheck.java:35)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:786)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:770)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:765)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:330)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.deepreach.web.DeepReachApplication.main(DeepReachApplication.java:37)
Caused by: com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource.init(DruidDataSource.java:939)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1463)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:1459)
	at com.alibaba.druid.pool.DruidDataSource.getConnection(DruidDataSource.java:83)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 21 common frames omitted
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 33 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 39 common frames omitted
2025-11-08 23:00:22 [main] ERROR c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接失败
org.springframework.jdbc.CannotGetJdbcConnectionException: Failed to obtain JDBC Connection
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:84)
	at org.springframework.jdbc.core.JdbcTemplate.execute(JdbcTemplate.java:388)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:476)
	at org.springframework.jdbc.core.JdbcTemplate.query(JdbcTemplate.java:486)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:519)
	at org.springframework.jdbc.core.JdbcTemplate.queryForObject(JdbcTemplate.java:526)
	at com.deepreach.web.config.DataSourceHealthCheck.run(DataSourceHealthCheck.java:43)
	at org.springframework.boot.SpringApplication.callRunner(SpringApplication.java:786)
	at org.springframework.boot.SpringApplication.lambda$callRunners$3(SpringApplication.java:770)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)
	at java.base/java.util.stream.SortedOps$SizedRefSortingSink.end(SortedOps.java:357)
	at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:510)
	at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)
	at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)
	at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)
	at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:596)
	at org.springframework.boot.SpringApplication.callRunners(SpringApplication.java:765)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:330)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1342)
	at org.springframework.boot.SpringApplication.run(SpringApplication.java:1331)
	at com.deepreach.web.DeepReachApplication.main(DeepReachApplication.java:37)
Caused by: com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at org.springframework.jdbc.datasource.SimpleDriverDataSource.getConnectionFromDriver(SimpleDriverDataSource.java:144)
	at org.springframework.jdbc.datasource.AbstractDriverBasedDataSource.getConnectionFromDriver(AbstractDriverBasedDataSource.java:205)
	at org.springframework.jdbc.datasource.AbstractDriverBasedDataSource.getConnection(AbstractDriverBasedDataSource.java:169)
	at org.springframework.jdbc.datasource.DataSourceUtils.fetchConnection(DataSourceUtils.java:160)
	at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:118)
	at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:81)
	... 21 common frames omitted
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 30 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 36 common frames omitted
2025-11-08 23:00:22 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 23:00:22 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 23:00:22 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:23 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:23 [Druid-ConnectionPool-Create-78629607] INFO  c.a.d.pool.DruidAbstractDataSource - {dataSource-1} failContinuous is true
2025-11-08 23:00:24 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:25 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:26 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:27 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:28 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:29 [Druid-ConnectionPool-Create-78629607] ERROR c.alibaba.druid.pool.DruidDataSource - create connection SQLException, url: jdbc:mysql://206.82.1.18:33900/smspikenew?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true&useSSL=false, errorCode 0, state 08S01
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at com.mysql.cj.jdbc.exceptions.SQLError.createCommunicationsException(SQLError.java:175)
	at com.mysql.cj.jdbc.exceptions.SQLExceptionsMapping.translateException(SQLExceptionsMapping.java:64)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:825)
	at com.mysql.cj.jdbc.ConnectionImpl.<init>(ConnectionImpl.java:446)
	at com.mysql.cj.jdbc.ConnectionImpl.getInstance(ConnectionImpl.java:239)
	at com.mysql.cj.jdbc.NonRegisteringDriver.connect(NonRegisteringDriver.java:188)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1703)
	at com.alibaba.druid.pool.DruidAbstractDataSource.createPhysicalConnection(DruidAbstractDataSource.java:1801)
	at com.alibaba.druid.pool.DruidDataSource$CreateConnectionThread.run(DruidDataSource.java:2947)
Caused by: com.mysql.cj.exceptions.CJCommunicationsException: Communications link failure

The last packet sent successfully to the server was 0 milliseconds ago. The driver has not received any packets from the server.
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)
	at java.base/jdk.internal.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
	at java.base/java.lang.reflect.Constructor.newInstanceWithCaller(Constructor.java:500)
	at java.base/java.lang.reflect.Constructor.newInstance(Constructor.java:481)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:62)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:105)
	at com.mysql.cj.exceptions.ExceptionFactory.createException(ExceptionFactory.java:150)
	at com.mysql.cj.exceptions.ExceptionFactory.createCommunicationsException(ExceptionFactory.java:166)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:582)
	at com.mysql.cj.protocol.a.NativeProtocol.readServerCapabilities(NativeProtocol.java:537)
	at com.mysql.cj.protocol.a.NativeProtocol.beforeHandshake(NativeProtocol.java:424)
	at com.mysql.cj.protocol.a.NativeProtocol.connect(NativeProtocol.java:1428)
	at com.mysql.cj.NativeSession.connect(NativeSession.java:134)
	at com.mysql.cj.jdbc.ConnectionImpl.connectOneTryOnly(ConnectionImpl.java:945)
	at com.mysql.cj.jdbc.ConnectionImpl.createNewIO(ConnectionImpl.java:815)
	... 6 common frames omitted
Caused by: java.io.EOFException: Can not read response from server. Expected to read 4 bytes, read 0 bytes before connection was unexpectedly lost.
	at com.mysql.cj.protocol.FullReadInputStream.readFully(FullReadInputStream.java:67)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeaderLocal(SimplePacketReader.java:81)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:63)
	at com.mysql.cj.protocol.a.SimplePacketReader.readHeader(SimplePacketReader.java:45)
	at com.mysql.cj.protocol.a.NativeProtocol.readMessage(NativeProtocol.java:576)
	... 12 common frames omitted
2025-11-08 23:00:30 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 76640 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 23:00:30 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 23:00:30 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 23:00:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 23:00:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 23:00:30 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 7 ms. Found 0 Redis repository interfaces.
2025-11-08 23:00:31 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 23:00:31 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 23:00:31 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 23:00:31 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 23:00:31 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 924 ms
2025-11-08 23:00:31 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 23:00:31 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 23:00:31 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:00:32 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 23:00:32 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:00:32 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@357e7113, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@8d23cd8, org.springframework.security.web.context.SecurityContextHolderFilter@579ee82, org.springframework.security.web.header.HeaderWriterFilter@3c65f2e1, org.springframework.web.filter.CorsFilter@5feaafb3, org.springframework.security.web.authentication.logout.LogoutFilter@1aea759d, com.deepreach.common.security.JwtAuthenticationFilter@4392362c, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@6c3884f5, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6778636f, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@20a46227, org.springframework.security.web.session.SessionManagementFilter@15405ba1, org.springframework.security.web.access.ExceptionTranslationFilter@531b1778, org.springframework.security.web.access.intercept.AuthorizationFilter@781bd9dd]
2025-11-08 23:00:32 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 23:00:32 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.676 seconds (process running for 2.961)
2025-11-08 23:00:32 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 23:00:45 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 23:00:45 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 23:00:47 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 23:00:49 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 23:00:49 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 23:00:49 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 23:00:49 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 23:00:49 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 23:00:49 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 23:00:49 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 23:00:49 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
2025-11-08 23:20:10 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closing ...
2025-11-08 23:20:10 [SpringApplicationShutdownHook] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} closed
2025-11-08 23:20:12 [main] INFO  c.deepreach.web.DeepReachApplication - Starting DeepReachApplication using Java 17.0.12 with PID 77181 (/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/deepreach-web/target/classes started by gak1 in /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild)
2025-11-08 23:20:12 [main] DEBUG c.deepreach.web.DeepReachApplication - Running with Spring Boot v3.2.0, Spring v6.1.1
2025-11-08 23:20:12 [main] INFO  c.deepreach.web.DeepReachApplication - The following 1 profile is active: "dev"
2025-11-08 23:20:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Multiple Spring Data modules found, entering strict repository configuration mode
2025-11-08 23:20:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2025-11-08 23:20:13 [main] INFO  o.s.d.r.c.RepositoryConfigurationDelegate - Finished Spring Data repository scanning in 6 ms. Found 0 Redis repository interfaces.
2025-11-08 23:20:13 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat initialized with port 8080 (http)
2025-11-08 23:20:13 [main] INFO  o.a.catalina.core.StandardService - Starting service [Tomcat]
2025-11-08 23:20:13 [main] INFO  o.a.catalina.core.StandardEngine - Starting Servlet engine: [Apache Tomcat/10.1.16]
2025-11-08 23:20:13 [main] INFO  o.a.c.c.C.[.[localhost].[/api] - Initializing Spring embedded WebApplicationContext
2025-11-08 23:20:13 [main] INFO  o.s.b.w.s.c.ServletWebServerApplicationContext - Root WebApplicationContext: initialization completed in 784 ms
2025-11-08 23:20:13 [main] DEBUG c.d.c.s.JwtAuthenticationFilter - Filter 'jwtAuthenticationFilter' configured for use
2025-11-08 23:20:13 [main] ERROR i.n.r.d.DnsServerAddressStreamProviders - Unable to load io.netty.resolver.dns.macos.MacOSDnsServerAddressStreamProvider, fallback to system defaults. This may result in incorrect DNS resolutions on MacOS. Check whether you have a dependency on 'io.netty:netty-resolver-dns-native-macos'. Use DEBUG level to see the full stack: java.lang.UnsatisfiedLinkError: failed to load the required native library
2025-11-08 23:20:14 [main] INFO  c.d.w.s.impl.FileStorageServiceImpl - 文件上传目录: /Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:20:14 [main] INFO  c.d.message.worker.SmsSendWorker - SmsSendWorker started
2025-11-08 23:20:14 [main] INFO  c.deepreach.web.config.WebMvcConfig - 静态资源映射配置：/uploads/** -> file:/Users/gak1/Documents/GitHub/deepreach-Server-side-rebuild/uploads
2025-11-08 23:20:14 [main] INFO  o.s.s.web.DefaultSecurityFilterChain - Will secure any request with [org.springframework.security.web.session.DisableEncodeUrlFilter@7612f385, org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@330d16af, org.springframework.security.web.context.SecurityContextHolderFilter@2a317af7, org.springframework.security.web.header.HeaderWriterFilter@13bf5fd, org.springframework.web.filter.CorsFilter@16f15a4, org.springframework.security.web.authentication.logout.LogoutFilter@781bd9dd, com.deepreach.common.security.JwtAuthenticationFilter@2328ec73, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@54f4734e, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6a26eee6, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@548c5127, org.springframework.security.web.session.SessionManagementFilter@2dbf8cfc, org.springframework.security.web.access.ExceptionTranslationFilter@4a7ac98b, org.springframework.security.web.access.intercept.AuthorizationFilter@20a46227]
2025-11-08 23:20:14 [main] INFO  o.s.b.w.e.tomcat.TomcatWebServer - Tomcat started on port 8080 (http) with context path '/api'
2025-11-08 23:20:14 [main] INFO  c.deepreach.web.DeepReachApplication - Started DeepReachApplication in 2.4 seconds (process running for 2.647)
2025-11-08 23:20:14 [main] INFO  c.d.web.config.DataSourceHealthCheck - 开始检查数据源配置...
2025-11-08 23:20:26 [main] INFO  c.alibaba.druid.pool.DruidDataSource - {dataSource-1} inited
2025-11-08 23:20:26 [main] INFO  c.d.web.config.DataSourceHealthCheck - 主数据源连接成功: PRIMARY_OK
2025-11-08 23:20:29 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据源连接成功: CLOUD_COMPUTER_OK
2025-11-08 23:20:31 [main] INFO  c.d.web.config.DataSourceHealthCheck - 云电脑数据库中admin用户记录数: 0
2025-11-08 23:20:31 [main] INFO  c.d.web.config.DataSourceHealthCheck - 数据源检查完成
2025-11-08 23:20:31 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 开始构建用户层级树缓存...
2025-11-08 23:20:31 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==>  Preparing: SELECT u.user_id AS userId, u.parent_user_id AS parentUserId FROM sys_user u WHERE u.status = '0'
2025-11-08 23:20:31 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - ==> Parameters: 
2025-11-08 23:20:31 [main] DEBUG c.d.c.c.m.S.selectAllUserHierarchyRelations - <==      Total: 70
2025-11-08 23:20:31 [main] INFO  c.d.c.c.s.impl.SysUserServiceImpl - 用户层级树缓存刷新成功：记录总数=70, 根节点数量=1
2025-11-08 23:20:31 [main] INFO  c.d.w.i.UserHierarchyCacheInitializer - 用户层级树缓存构建完成
